<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitness Tracker (Walk + Strength + Push-ups)</title>
  <script type="text/javascript" src="https://ff.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=x-c_Q7h6btaxJUTTqE3YUieKd4iveZ8jcLdypyjI5HjeWCeQL9FeL8eUTM3gaL6wPyM4ZhzxTS2qeO7zkGSV1yeGkec6JyGWWF0pj0bAA_ejvQ8b16XkxzzjFDPgZkJkgMmrRxZgmXBsvw56FI5jKWBYzFB1tyds_iFOnPpTQwc_7fFR69qXULWZ1oEBIgqpx_kbFhSHV4RrohKZXtJeAypLBtGQM5KsmA957NPDXuTCpqVDwL4JBPk7FARWECVPaG8QuAd0dEs_F-WU_899NwAw8tzo6l_Fo9uxPYwidBa_0DlGVyA_AoUO4-AnzdPqPDet8DXGhosO0L7B99J01ljToYvPBIVfNXGAzFiLyjmVXDfZx2PClvNBSwqBFpMgvnuiAMXASMSfoxz9RyCdVUWKqdAUtLfnmv8nUKJJ-XPNVNKwMTNZ7H5Wg0tDLL9zqEZP0Mr5V6W52lpCTb2BK0ybBVsUXVi8XZMJfs9I0cl8clkgW6WYeTjBuG1-Mj8yJ3zMxK1wVCAOjyEnb1x8UVgcHvTtuQWBBYBnP-fBTkku5b7pRH0vbfPkF1-wVM52nxg4YOe7YOzbmpKQa23T1k7UVm_yDkkb_tQa-s6arMv48KVQXHZ3XuUeYPspEqoSeL5ZlbnIZvPcd0pJPnWh2alzWFC_y5e2d0GpHbK0BcVCIGxR1ET_yKguCJsjn2PaGrk6wXxmdFaXfbO1srXDnU93cpT7R0ysFfSY9_HXpsDk0egcH_GOEvgWHyDwfek0QXdJJef4j7SGvxul3BgBckQa7S1Lf8i0lB_vSCMsmAH_ZMua4CYKNoNDpCam9KgP7ke98oPy6zewaHOa9RsRrZf9b8MQsdIB6aaXNKUgEO4OYt49rMTBLF8_CAy0xNyi9q2q1acvAGBLlj1QGN5JNa-jpFurN2TtnoTVeqpC7zQPc76KPHciKnVtne4r0I91w25h-XtJgPe4fysGyDGVvJWOl6Ycfj_Pm-exGYntvDwK9PbmZ1r-maGvQf5g_eAsHoWZbVx7OMdfSk7X4gteX9PfAswGdmlrxtw3oGSbiSvxgrcf1SAnDyHy24NaVNUaqIR2T8YXe7EGrbjUVdi-sFnL7ZHFbQnW4f2M9qUhOvV2izBxEvZpmNra4zuhibXSaysIlH2heOclWeT5nD-LeO--TYKC2D9kim9xaJu7pRGVyiC2bxMm1hAo92vwWrSrLtAzDje2xzITwNo729ZMLcRb-6v39aF03uUlk0o2sAK76KmA3LwgYGoCX0X6fTT-KtszL1QC8tGG34tUXDJlaO_30kY2Rh3D5x-lP9OrAPdP4FHbuSA4BgNrGa9D2g_N1CU7J4J1lApwNrtS0iVF6AklWSqaB-8gaiyuyfyqXNZ6MCx1UphlDvda_BWB7gJoEsntLCjQY_o-N2RWU7K6D47E6F7rA7wUBSRIdgtvI4c8XcoRujVkGO9vd2101WmzzgXrVbmtyX5t3-Rt3Elpok9DdXxWtweGFhgN4B4eIkG37riJQHzDQ6t_ktzbtJWSpTfi2-9gTH1OSErsLWauCbY_nE1W0FEPjQlU1WNRXE-ApU0uXL-h0COhbtJrClqhV5oNA0HwZuAj0tx6wnWG7hpcdFeMSP6hsGNcUD227dWOEaT8D2kTE2Z1jX5abb44SE907_i9kfIb-tmlzPfRss9qB0X0OeFZC2sQiHRJI-iZltsMo3rUa-jROh0NeSUU" nonce="e16540e567065268e7436435462e61df" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://ff.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9tYWlsLWF0dGFjaG1lbnQuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2F0dGFjaG1lbnQvdS8wLz91aT0yJmlrPWRhMTAzMDRlMzUmYXR0aWQ9MC4xJnBlcm1tc2dpZD1tc2ctYTpyMTQwNjc2MDUyNjAzNjk5Nzc2OSZ0aD0xOWMxNTJlMWI1YzUzZTk0JnZpZXc9YXR0JmRpc3A9c2FmZSZyZWFsYXR0aWQ9Zl9tbDJseWtpazAmencmc2FkZGJhdD1BTkdqZEotaTkxTjdRLXlOVkpwZmpEX3Bnc29zZ2RBV3QwVWc4OFkyMEd0SmlLOEdXNS1BN1NmNDBqdy1ULWxkREFlMDd4NlNzQU85UEF5TkE1cDdncWZGajJXcUVvc2RDYTRjNzBLZWlJLTRBNzItLTA2RGFhREloT1V2R1puRDhDTzRMN29yQUZzQmRqZ0hQMVUtNWpMbU1wNV9DS0lrOFVLMGpBZ01MRW12aUZmeEwwb3ZSSUVMQ2RNTnh5NUlLM1FyanRoVVFyU0hpZjVldTdLVFN1UGhWNDFtMmhBQzFHWXVjSHdCS3R2aWZDUVFZd0I2TXJiT3lscTA2c3ozQ1NHV0RjTE03aGhfY3ZpUUQtWGhNZEoxTDAtQ0FSWmp2NDRla01qYXhIc0t1cDJkUXFpc09TeGx2QTQxNzk1ejRJSURjM1EtZ05TN3BlRlItNlBtc1lYVU51Z2JuelUzOHp1cVg0cUVsSVZHOTRCYmtlbEpnd3NRaFd2bVNVNnNCdk5GeFdXRjY0N3RYZlYtLWw5NXF4TktJNTRtbXNBZkhKMTJPY2ZORmQtc3p4SUJsSXdIRjdHck41dlExNnBhVGM0cEdMd1RNTlpUaWNTM0x2OVlUM0VfM2xyblQ0a1F3c0VHNV9CNEt2RHhzUVlEX3RqVnVXWVB5bWdJWkhXbVJkZEYwNFhkdkM5dXE0Rml5NTVSQ2tDZktJMGlINlVVQXhJMDZ0WDlJdDBRSjMxOFZCTVJDV3ZxQjZSV0Z2VVRsd1FJdmlsdTN1cHA0eTN3Nk9OR3l4amZ2R3h2WXNIQXN4WkRGSGl1cVk1bWNuWXJEMzgyVngzZXNxNjRhOGVJaEJ5cW56U21ia0VqUERHSWpnc09xNDFRbXN3SHVabjlYa3ZIM0tuekhBWUJJa18wU2Zya3g5Wmc3aTYxRGY3X3FlSC1oUnFWcWtHUlVHRU9ZODdXenBaRW5fWEd6a2tBV19zTEFwV0pNQ2tpZ0tNZEVuS0tDTmQ3UkV5UjlPWmlwRF8zSmtsMDRjSGhhdHhqN0NlYXExemozNHFMZjRBaU1lMXE0N1I5Tk0yd2trcnFXVWI5NFlDQTJvTGdYTjRkU19OdjhQSlRXYkNDV1ZiQ2l4RUpxcjhsQ2RBbmNNQWp4RWFKYlFjVlBpdkI3cjE0YjhPX2xYUGRRYXR3T1lRS1ZTeHp1NUg1WDJ5NzBGRzQ4TXROMndQRjk1VzJJTnFTMHNUdFE1cGI3R1JXVVZocnNtQlJnU1lVNDMwUGZNM0xWbnlLUldxeXNFS3NHLU1hWGN5N1NjdTZRS0VPM2JYaG5TOFRFajBHME5xbjcxUzFEOUlkMGpnSDd4d0t1cDlNSG9sQTNMOUF1ZUdwbmM1bnkycHpqa0RNbkFCenhJTWlfd2dIb1BXYXN3"/><style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7f9; color: #111; }
    header { padding: 16px; background: #111; color: #fff; }
    header h1 { margin: 0 0 6px; font-size: 18px; }
    header p { margin: 0; opacity: 0.8; font-size: 13px; }
    main { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .tabs { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
    .tabbtn {
      border: 1px solid #d0d5dd; background: #fff; padding: 10px 12px;
      border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px;
    }
    .tabbtn.active { background: #111; color: #fff; border-color: #111; }
    .panel { display: none; }
    .panel.active { display: block; }

    .card {
      background: #fff; border: 1px solid #e5e7eb; border-radius: 14px;
      padding: 14px; margin-bottom: 14px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 10px; }
    .field { grid-column: span 6; }
    .field.sm { grid-column: span 3; }
    .field.lg { grid-column: span 12; }
    label { display: block; font-size: 12px; opacity: 0.8; margin: 2px 0 6px; }
    input, select, textarea, button {
      width: 100%; box-sizing: border-box; padding: 10px 10px;
      border: 1px solid #d0d5dd; border-radius: 10px; background: #fff; font-size: 14px;
    }
    textarea { min-height: 70px; resize: vertical; }
    button.primary { background: #111; color: #fff; border-color: #111; font-weight: 700; }
    button.danger { background: #b42318; color: #fff; border-color: #b42318; font-weight: 700; }
    button.muted { background: #f3f4f6; border-color: #d0d5dd; }
    .btnrow { display: flex; gap: 10px; flex-wrap: wrap; }
    .btnrow > * { flex: 1 1 180px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eef0f4; padding: 10px 8px; text-align: left; font-size: 13px; vertical-align: top; }
    th { font-size: 12px; opacity: 0.75; }
    .row-actions { display: flex; gap: 8px; }
    .small { font-size: 12px; opacity: 0.75; }
    .kpi { display: grid; grid-template-columns: repeat(12, 1fr); gap: 10px; }
    .kpi .box { grid-column: span 4; background: #fff; border: 1px solid #e5e7eb; border-radius: 14px; padding: 12px; }
    .kpi .box h3 { margin: 0 0 6px; font-size: 12px; opacity: 0.75; }
    .kpi .box .num { font-size: 22px; font-weight: 800; }
    .rule {
      padding: 10px; border-radius: 12px; background: #111; color: #fff; font-weight: 700;
      display: inline-block;
    }
    @media (max-width: 720px) {
      .field, .field.sm { grid-column: span 12; }
      .kpi .box { grid-column: span 12; }
    }
  </style>
</head>

<body>
<header>
  <h1>Fitness Tracker — Walk (3×/wk) + Strength (2×/wk) + Push-ups</h1>
  <p>Offline. Data saved in your browser. Export weekly so you can move devices safely.</p>
</header>

<main>
  <div class="tabs">
    <button class="tabbtn active" data-tab="overview">Overview</button>
    <button class="tabbtn" data-tab="walks">Walking Log</button>
    <button class="tabbtn" data-tab="strength">Strength Log</button>
    <button class="tabbtn" data-tab="pushups">Push-up Progress</button>
    <button class="tabbtn" data-tab="backup">Backup / Reset</button>
  </div>

  <!-- OVERVIEW -->
  <section id="overview" class="panel active">
    <div class="card">
      <h2>Weekly plan (simple, repeatable)</h2>
      <div class="small">The whole point is consistency, not punishment.</div>
      <div style="margin:10px 0 12px;">
        <span class="rule">Rule: Never miss twice.</span>
      </div>
      <ul class="small" style="line-height:1.6; margin-top: 10px;">
        <li><b>Mon</b> Walk (30–60 min, easy-ish pace)</li>
        <li><b>Tue</b> Strength (dumbbells + push-up practice)</li>
        <li><b>Wed</b> Walk</li>
        <li><b>Thu</b> Rest / mobility</li>
        <li><b>Fri</b> Strength</li>
        <li><b>Sat</b> Walk</li>
        <li><b>Sun</b> Off</li>
      </ul>
    </div>

    <div class="kpi" id="kpis"></div>

    <div class="card">
      <h2>Quick setup</h2>
      <div class="grid">
        <div class="field sm">
          <label for="profileAge">Age</label>
          <input id="profileAge" type="number" min="1" max="120" />
        </div>
        <div class="field sm">
          <label for="profileStart">Start date</label>
          <input id="profileStart" type="date" />
        </div>
        <div class="field sm">
          <label for="profileGoal">Primary goal</label>
          <select id="profileGoal">
            <option>Fat loss + consistency</option>
            <option>Strength + mobility</option>
            <option>General fitness</option>
            <option>Cardio endurance</option>
          </select>
        </div>
        <div class="field lg">
          <label for="profileNotes">Notes (your “why”)</label>
          <textarea id="profileNotes" placeholder="Example: I walk 3x/week and lift 2x/week to feel fitter, lose a bit of weight, and finally crack the full push-up."></textarea>
        </div>
        <div class="field lg">
          <div class="btnrow">
            <button class="primary" id="saveProfile">Save profile</button>
            <button class="muted" id="fillToday">Set today as start date</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- WALKING LOG -->
  <section id="walks" class="panel">
    <div class="card">
      <h2>Add a walk</h2>
      <div class="grid">
        <div class="field sm">
          <label for="walkDate">Date</label>
          <input id="walkDate" type="date" />
        </div>
        <div class="field sm">
          <label for="walkMins">Duration (minutes)</label>
          <input id="walkMins" type="number" min="1" step="1" placeholder="e.g., 45" />
        </div>
        <div class="field sm">
          <label for="walkDist">Distance (optional)</label>
          <input id="walkDist" type="text" placeholder="e.g., 3.2 mi or 5 km" />
        </div>
        <div class="field sm">
          <label for="walkEffort">Effort (1–10)</label>
          <input id="walkEffort" type="number" min="1" max="10" step="1" placeholder="e.g., 5" />
        </div>
        <div class="field lg">
          <label for="walkNotes">Notes</label>
          <textarea id="walkNotes" placeholder="How did it feel? Any aches? Mood after?"></textarea>
        </div>
        <div class="field lg">
          <button class="primary" id="addWalk">Add walk</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Walk history</h2>
      <div class="small">Tip: A “short walk” still counts. Log it anyway.</div>
      <div style="overflow:auto; margin-top:10px;">
        <table id="walkTable">
          <thead>
            <tr>
              <th>Date</th><th>Minutes</th><th>Distance</th><th>Effort</th><th>Notes</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- STRENGTH LOG -->
  <section id="strength" class="panel">
    <div class="card">
      <h2>Add a strength entry</h2>
      <div class="small">Log by exercise. You can add multiple rows for one session.</div>
      <div class="grid">
        <div class="field sm">
          <label for="strDate">Date</label>
          <input id="strDate" type="date" />
        </div>
        <div class="field sm">
          <label for="strExercise">Exercise</label>
          <select id="strExercise">
            <option>Goblet Squat</option>
            <option>Dumbbell Row</option>
            <option>Dumbbell Chest Press</option>
            <option>Shoulder Press</option>
            <option>Romanian Deadlift</option>
            <option>Farmer’s Carry</option>
            <option>Core (Plank / Dead Bug)</option>
            <option>Other</option>
          </select>
        </div>
        <div class="field sm">
          <label for="strWeight">Weight used</label>
          <input id="strWeight" type="text" placeholder="e.g., 20 lb or 10 kg" />
        </div>
        <div class="field sm">
          <label for="strSets">Sets</label>
          <input id="strSets" type="number" min="1" step="1" value="3" />
        </div>
        <div class="field sm">
          <label for="strReps">Reps</label>
          <input id="strReps" type="number" min="1" step="1" placeholder="e.g., 10" />
        </div>
        <div class="field lg">
          <label for="strNotes">Notes</label>
          <textarea id="strNotes" placeholder="RPE? Felt easy/hard? Any tweaks?"></textarea>
        </div>
        <div class="field lg">
          <button class="primary" id="addStrength">Add strength entry</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Strength history</h2>
      <div style="overflow:auto; margin-top:10px;">
        <table id="strengthTable">
          <thead>
            <tr>
              <th>Date</th><th>Exercise</th><th>Weight</th><th>Sets</th><th>Reps</th><th>Notes</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- PUSH-UPS -->
  <section id="pushups" class="panel">
    <div class="card">
      <h2>Push-up progress</h2>
      <div class="small">Train the slope. Gravity is negotiable.</div>
      <div class="grid">
        <div class="field sm">
          <label for="puDate">Date</label>
          <input id="puDate" type="date" />
        </div>
        <div class="field sm">
          <label for="puType">Type</label>
          <select id="puType">
            <option>Wall</option>
            <option>Incline (hands on table/counter)</option>
            <option>Knees</option>
            <option>Full</option>
            <option>Negative (slow lowering)</option>
          </select>
        </div>
        <div class="field sm">
          <label for="puMax">Max reps (best set)</label>
          <input id="puMax" type="number" min="0" step="1" placeholder="e.g., 6" />
        </div>
        <div class="field sm">
          <label for="puTotal">Total reps (all sets)</label>
          <input id="puTotal" type="number" min="0" step="1" placeholder="e.g., 20" />
        </div>
        <div class="field lg">
          <label for="puNotes">Notes</label>
          <textarea id="puNotes" placeholder="How did it feel? Form? Shoulder/wrist?"></textarea>
        </div>
        <div class="field lg">
          <button class="primary" id="addPushup">Add push-up entry</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Push-up history</h2>
      <div style="overflow:auto; margin-top:10px;">
        <table id="pushupTable">
          <thead>
            <tr>
              <th>Date</th><th>Type</th><th>Max</th><th>Total</th><th>Notes</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- BACKUP -->
  <section id="backup" class="panel">
    <div class="card">
      <h2>Backup / Move to another device</h2>
      <div class="small">
        Your entries are stored in this browser only. Export weekly so you can import on another device.
      </div>
      <div class="btnrow" style="margin-top:12px;">
        <button class="primary" id="exportBtn">Export data (JSON)</button>
        <label style="display:block;">
          <span class="small" style="display:block; margin-bottom:6px;">Import data (JSON)</span>
          <input id="importFile" type="file" accept="application/json" />
        </label>
      </div>
    </div>

    <div class="card">
      <h2>Danger zone</h2>
      <div class="small">This wipes everything from this browser.</div>
      <div class="btnrow" style="margin-top:12px;">
        <button class="danger" id="resetBtn">Reset all data</button>
      </div>
    </div>
  </section>
</main>

<script>
  // ---------- storage ----------
  const KEY = "fitnessTracker_v1";

  const defaultData = {
    profile: {
      age: 58,
      startDate: "",
      goal: "Fat loss + consistency",
      notes: ""
    },
    walks: [],
    strength: [],
    pushups: []
  };

  function loadData() {
    try {
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : structuredClone(defaultData);
    } catch {
      return structuredClone(defaultData);
    }
  }

  function saveData() {
    localStorage.setItem(KEY, JSON.stringify(data));
    renderAll();
  }

  let data = loadData();

  // ---------- helpers ----------
  function todayISO() {
    const d = new Date();
    const pad = (n) => String(n).padStart(2, "0");
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }

  function esc(s) {
    return String(s ?? "").replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function removeById(arr, id) {
    const idx = arr.findIndex(x => x.id === id);
    if (idx >= 0) arr.splice(idx, 1);
  }

  function weekStartISO(dateISO) {
    // Monday as start of week
    const d = new Date(dateISO + "T00:00:00");
    const day = (d.getDay() + 6) % 7; // Mon=0 ... Sun=6
    d.setDate(d.getDate() - day);
    return d.toISOString().slice(0,10);
  }

  function inThisWeek(dateISO) {
    const ws = weekStartISO(todayISO());
    const d = new Date(dateISO + "T00:00:00");
    const w = new Date(ws + "T00:00:00");
    const diffDays = Math.floor((d - w) / 86400000);
    return diffDays >= 0 && diffDays < 7;
  }

  function lastNDaysCount(arr, n) {
    const now = new Date(todayISO() + "T00:00:00");
    return arr.filter(x => {
      const d = new Date((x.date || "") + "T00:00:00");
      const diff = Math.floor((now - d) / 86400000);
      return diff >= 0 && diff < n;
    }).length;
  }

  // ---------- tabs ----------
  document.querySelectorAll(".tabbtn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tabbtn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  });

  // ---------- profile ----------
  const profileAge = document.getElementById("profileAge");
  const profileStart = document.getElementById("profileStart");
  const profileGoal = document.getElementById("profileGoal");
  const profileNotes = document.getElementById("profileNotes");

  document.getElementById("fillToday").addEventListener("click", () => {
    profileStart.value = todayISO();
  });

  document.getElementById("saveProfile").addEventListener("click", () => {
    data.profile.age = Number(profileAge.value || 58);
    data.profile.startDate = profileStart.value || "";
    data.profile.goal = profileGoal.value || "Fat loss + consistency";
    data.profile.notes = profileNotes.value || "";
    saveData();
    alert("Saved.");
  });

  // ---------- add walk ----------
  document.getElementById("walkDate").value = todayISO();
  document.getElementById("addWalk").addEventListener("click", () => {
    const entry = {
      id: crypto.randomUUID(),
      date: document.getElementById("walkDate").value || todayISO(),
      mins: Number(document.getElementById("walkMins").value || 0),
      dist: document.getElementById("walkDist").value || "",
      effort: Number(document.getElementById("walkEffort").value || 0),
      notes: document.getElementById("walkNotes").value || ""
    };
    if (!entry.mins) return alert("Add at least the walk duration (minutes).");
    data.walks.unshift(entry);
    // clear some fields
    document.getElementById("walkMins").value = "";
    document.getElementById("walkDist").value = "";
    document.getElementById("walkEffort").value = "";
    document.getElementById("walkNotes").value = "";
    saveData();
  });

  // ---------- add strength ----------
  document.getElementById("strDate").value = todayISO();
  document.getElementById("addStrength").addEventListener("click", () => {
    const entry = {
      id: crypto.randomUUID(),
      date: document.getElementById("strDate").value || todayISO(),
      exercise: document.getElementById("strExercise").value || "",
      weight: document.getElementById("strWeight").value || "",
      sets: Number(document.getElementById("strSets").value || 0),
      reps: Number(document.getElementById("strReps").value || 0),
      notes: document.getElementById("strNotes").value || ""
    };
    if (!entry.exercise) return alert("Pick an exercise.");
    if (!entry.sets || !entry.reps) return alert("Add sets and reps.");
    data.strength.unshift(entry);
    document.getElementById("strWeight").value = "";
    document.getElementById("strReps").value = "";
    document.getElementById("strNotes").value = "";
    saveData();
  });

  // ---------- add push-ups ----------
  document.getElementById("puDate").value = todayISO();
  document.getElementById("addPushup").addEventListener("click", () => {
    const entry = {
      id: crypto.randomUUID(),
      date: document.getElementById("puDate").value || todayISO(),
      type: document.getElementById("puType").value || "",
      max: Number(document.getElementById("puMax").value || 0),
      total: Number(document.getElementById("puTotal").value || 0),
      notes: document.getElementById("puNotes").value || ""
    };
    if (!entry.type) return alert("Pick a push-up type.");
    if (!entry.max && !entry.total) return alert("Add max reps or total reps (or both).");
    data.pushups.unshift(entry);
    document.getElementById("puMax").value = "";
    document.getElementById("puTotal").value = "";
    document.getElementById("puNotes").value = "";
    saveData();
  });

  // ---------- render tables ----------
  function renderWalks() {
    const tb = document.querySelector("#walkTable tbody");
    tb.innerHTML = "";
    for (const w of data.walks) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${esc(w.date)}</td>
        <td>${esc(w.mins)}</td>
        <td>${esc(w.dist)}</td>
        <td>${esc(w.effort || "")}</td>
        <td>${esc(w.notes)}</td>
        <td>
          <div class="row-actions">
            <button class="muted" data-delwalk="${esc(w.id)}">Delete</button>
          </div>
        </td>`;
      tb.appendChild(tr);
    }
    tb.querySelectorAll("[data-delwalk]").forEach(btn => {
      btn.addEventListener("click", () => {
        if (!confirm("Delete this walk?")) return;
        removeById(data.walks, btn.dataset.delwalk);
        saveData();
      });
    });
  }

  function renderStrength() {
    const tb = document.querySelector("#strengthTable tbody");
    tb.innerHTML = "";
    for (const s of data.strength) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${esc(s.date)}</td>
        <td>${esc(s.exercise)}</td>
        <td>${esc(s.weight)}</td>
        <td>${esc(s.sets)}</td>
        <td>${esc(s.reps)}</td>
        <td>${esc(s.notes)}</td>
        <td>
          <div class="row-actions">
            <button class="muted" data-delstr="${esc(s.id)}">Delete</button>
          </div>
        </td>`;
      tb.appendChild(tr);
    }
    tb.querySelectorAll("[data-delstr]").forEach(btn => {
      btn.addEventListener("click", () => {
        if (!confirm("Delete this strength entry?")) return;
        removeById(data.strength, btn.dataset.delstr);
        saveData();
      });
    });
  }

  function renderPushups() {
    const tb = document.querySelector("#pushupTable tbody");
    tb.innerHTML = "";
    for (const p of data.pushups) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${esc(p.date)}</td>
        <td>${esc(p.type)}</td>
        <td>${esc(p.max)}</td>
        <td>${esc(p.total)}</td>
        <td>${esc(p.notes)}</td>
        <td>
          <div class="row-actions">
            <button class="muted" data-delpu="${esc(p.id)}">Delete</button>
          </div>
        </td>`;
      tb.appendChild(tr);
    }
    tb.querySelectorAll("[data-delpu]").forEach(btn => {
      btn.addEventListener("click", () => {
        if (!confirm("Delete this push-up entry?")) return;
        removeById(data.pushups, btn.dataset.delpu);
        saveData();
      });
    });
  }

  function renderProfile() {
    profileAge.value = data.profile.age ?? 58;
    profileStart.value = data.profile.startDate ?? "";
    profileGoal.value = data.profile.goal ?? "Fat loss + consistency";
    profileNotes.value = data.profile.notes ?? "";

    // default dates for forms if empty
    document.getElementById("walkDate").value ||= todayISO();
    document.getElementById("strDate").value ||= todayISO();
    document.getElementById("puDate").value ||= todayISO();
  }

  function renderKPIs() {
    const el = document.getElementById("kpis");

    const walksThisWeek = data.walks.filter(w => w.date && inThisWeek(w.date)).length;
    const strengthThisWeek = data.strength.filter(s => s.date && inThisWeek(s.date)).length;
    const pushupsThisWeek = data.pushups.filter(p => p.date && inThisWeek(p.date)).length;

    const walks7 = lastNDaysCount(data.walks, 7);
    const strength7 = lastNDaysCount(data.strength, 7);

    const bestFull = Math.max(0, ...data.pushups.filter(p => p.type === "Full").map(p => Number(p.max || 0)));
    const bestAny = Math.max(0, ...data.pushups.map(p => Number(p.max || 0)));

    el.innerHTML = `
      <div class="box">
        <h3>Walks this week (goal 3)</h3>
        <div class="num">${walksThisWeek}</div>
        <div class="small">Last 7 days: ${walks7}</div>
      </div>
      <div class="box">
        <h3>Strength entries this week (goal 2 sessions)</h3>
        <div class="num">${strengthThisWeek}</div>
        <div class="small">Last 7 days: ${strength7}</div>
      </div>
      <div class="box">
        <h3>Push-up best (Any type / Full)</h3>
        <div class="num">${bestAny} / ${bestFull}</div>
        <div class="small">Log even tiny sessions. Momentum wins.</div>
      </div>
    `;
  }

  function renderAll() {
    renderProfile();
    renderKPIs();
    renderWalks();
    renderStrength();
    renderPushups();
  }

  // ---------- backup ----------
  document.getElementById("exportBtn").addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `fitness-tracker-backup-${todayISO()}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  document.getElementById("importFile").addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    try {
      const text = await file.text();
      const imported = JSON.parse(text);
      // basic validation
      if (!imported || typeof imported !== "object") throw new Error("Invalid file.");
      data = {
        profile: imported.profile ?? structuredClone(defaultData.profile),
        walks: Array.isArray(imported.walks) ? imported.walks : [],
        strength: Array.isArray(imported.strength) ? imported.strength : [],
        pushups: Array.isArray(imported.pushups) ? imported.pushups : []
      };
      saveData();
      alert("Imported successfully.");
      e.target.value = "";
    } catch (err) {
      alert("Import failed: " + (err?.message || "Unknown error"));
      e.target.value = "";
    }
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    if (!confirm("This will wipe all your data on this device/browser. Continue?")) return;
    data = structuredClone(defaultData);
    saveData();
    alert("Reset complete.");
  });

  // ---------- initial render ----------
  // If profile start date is blank, set it to today (quietly)
  if (!data.profile.startDate) data.profile.startDate = todayISO();
  saveData();
</script>
</body>
</html>
